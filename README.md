# Домашнее задание к занятию «Микросервисы: подходы» -- Байков Михаил

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.
### Ответ 1
С моей точки зрения идеальным вариантом будет использование Gitlab CE. Популярная система, много специалистов кто с ней работал. Преимущества Gitlab Enterprise в России не существенны и малореализуемы. Может использоваться как в облаке, например yandex cloud так и в дальнейшем on-premise в случае возникновения требований ИБ (есть опыт). Есть поддержка версионности через git,есть возможность сборки по триггеру(например коммит или таг), есть возможность запуска пайплайна "по кнопке". Есть гибкая система настройки параметров пайплайна через переменные. Есть возможность безопасного хранения секретов для использования в пайплайнах. Есть возможность сборки разных веток на разных раннерах и на разные сервера из одного репозитория по тегу. Тестовая ветка собирается на раннерах тестового докера и запускается на тесте, мастер собирается в прод по мерджу от релиз-менеджера или девопса. Есть возможность кастомизации пайплайнов через переменные и дефолтные значения. Есть реджистри для хранения артефактов сборки. Есть возможность в "два клика" равернуть в докере раннеры. Без проблем возможна параллельная сборка через concurent runner запускаемых раннером. Так же и с тестами. С моей точки зрения gitlab на текущий момент является идеальным решением для команды разработки и я активно применяю его в работе. Особенно интересно на текущий момент для меня использование раннеров в докере совместно с kaniko позволяющем обезопасить engine докера и сервер не предоставляя излишних прав при сборке контейнера с исходным кодом.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

### Ответ 2

На текущий момент наиболее эффективным решением представляется fluent-bit в качестве сборщика логов ввиду высокой производительности и низкого потребления ресурсов. Стандартизация. Возможность использовать как в кластере Кубернетис, так и на отдельных серверах. Достаточная надежность в плане доставки логов. В качестве хранилища логов пока на мой взгляд вне конкуренции elastic со "своим" lucene. В качестве средства визуализации я бы выбрал opensearch. Вввиду понятных событий классика elastic+Kibana стала несколько проблематичной. В связи с этим совершенно логично выглядит использование Opensearch вместо Kibana у которого конечно есть серьезные минусы в плане user-frendly реализации, но в отличии от Кибаны он не строит сетевые козни)))

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

### Ответ 3
Для собра информации с хостов я бы предложил использовать Zabbix, очень простая в настройке система мониторинга для уровня хостов/ВМ которую использую уже много лет. Однако для сбора метрик с микросервисов он конечно не очень подходит. Тут бы я предложил использовать либо Прометеус + экспортер, либо Вектор. В зависимости от реализации микросервисов(Докер или Кубер). Для визуализации получаемых метрик однозначно Графана. На мой взгляд конкурентов у нее в данном разрезе нет) Плюс Графана позволяет визуализировать метрики из разных источников. Заббикс это "вещь в себе" со своими графиками и дашбордами, Графана же позволяет выйти за рамки определенной системы и строить "красоту" получая данные из разных источников. В данном случае Заббикс для "Железа" и прометеус/вектор для микросервисов.
